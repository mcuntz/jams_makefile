# -*- Makefile -*-

SHELL = /bin/bash

.SUFFIXES:
.SUFFIXES: .f90 .o .for .f

all: $(PROG)

$(PROG): $(OBJS) $(FOROBJS) $(FOBJS)
	$(LD) $(LDFLAGS) -o $(PROG) $(OBJS) $(FOROBJS) $(FOBJS) $(LIBS)

$(OBJS): $(OBJPATH)/%.o: %.f90
ifeq ($(compiler),gnu41)
	$(F90) -E -x c $(DEFINES) $(INCLUDES) $(F90FLAGS) $< > $(OBJPATH)/tmp.gf3.$(notdir $<)
	$(F90) $(DEFINES) $(INCLUDES) $(F90FLAGS) -c $(OBJPATH)/tmp.gf3.$(notdir $<) -o $@
	rm -r $(OBJPATH)/tmp.gf3.$(notdir $<)
else
	$(F90) $(DEFINES) $(INCLUDES) $(F90FLAGS) -c $< -o $@
endif

$(FOROBJS): $(OBJPATH)/%.o: %.for
ifeq ($(compiler),gnu41)
	$(FC) -E -x c $(DEFINES) $(INCLUDES) $(FCFLAGS) $< > $(OBJPATH)/tmp.gf3.$(notdir $<)
	$(FC) $(DEFINES) $(INCLUDES) $(FCFLAGS) -c $(OBJPATH)/tmp.gf3.$(notdir $<) -o $@
	rm -r $(OBJPATH)/tmp.gf3.$(notdir $<)
else
	$(FC) $(DEFINES) $(INCLUDES) $(FCFLAGS) -c $< -o $@
endif

$(FOBJS): $(OBJPATH)/%.o: %.f
ifeq ($(compiler),gnu41)
	$(FC) -E -x c $(DEFINES) $(INCLUDES) $(FCFLAGS) $< > $(OBJPATH)/tmp.gf3.$(notdir $<)
	$(FC) $(DEFINES) $(INCLUDES) $(FCFLAGS) -c $(OBJPATH)/tmp.gf3.$(notdir $<) -o $@
	rm -r $(OBJPATH)/tmp.gf3.$(notdir $<)
else
	$(FC) $(DEFINES) $(INCLUDES) $(FCFLAGS) -c $< -o $@
endif

# All dependencies create by perl script makedeps.pl
include $(OBJPATH)/make.deps
